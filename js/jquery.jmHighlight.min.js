/*!***************************************************
 * jmHighlight
 * Version 2.3.3
 * Copyright (c) 2014-2015, Julian Motz
 * For the full copyright and license information, 
 * please view the LICENSE file that was distributed 
 * with this source code.
 *****************************************************/
(function(g,c){"function"===typeof define&&define.amd?define(["jquery"],function(d){return c(d,g)}):"object"===typeof exports?c(require("jquery"),g):c(g.jQuery,g)})(this,function(g){function c(a,b,l){this.options=d.extend({},{debug:!1,element:"span",className:"highlight",filter:[],separateWordSearch:!1,diacritics:!0},l);this.keyword="string"===typeof b?b:"";this.$elements=d();a instanceof d&&0<a.length&&(this.$elements=a.add(a.find("*")),a=this.getFilteredElements(),0!=a&&(this.$elements=a));return this}
var d=g;c.prototype.diacritics="a\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5\u0100\u0101\u0105\u0104 c\u00c7\u00e7\u0107\u0106\u010d\u010c d\u0111\u0110\u010f\u010e e\u00c8\u00c9\u00ca\u00cb\u00e8\u00e9\u00ea\u00eb\u011b\u011a\u0112\u0113\u0119\u0118 i\u00cc\u00cd\u00ce\u00cf\u00ec\u00ed\u00ee\u00ef\u012a\u012b l\u0142\u0141 n\u00d1\u00f1\u0148\u0147\u0144\u0143 o\u00d2\u00d3\u00d4\u00d5\u00d5\u00d6\u00d8\u00f2\u00f3\u00f4\u00f5\u00f6\u00f8\u014c\u014d r\u0159\u0158 s\u0160\u0161\u015b\u015a t\u0165\u0164 u\u00d9\u00da\u00db\u00dc\u00f9\u00fa\u00fb\u00fc\u016f\u016e\u016a\u016b y\u0178\u00ff\u00fd\u00dd z\u017d\u017e\u017c\u017b\u017a\u0179".split(" ");
c.prototype.getFilteredElements=function(){var a=this.options.filter;if("object"!==typeof a||0==this.$elements instanceof d||"[object Array]"!=Object.prototype.toString.call(a))return!1;var b=this.$elements;return b=b.filter(function(){for(var b=d(this),h=!1,e=0,f=a.length;e<f;e++)b.is(a[e])&&(h=!0);return h?!1:!0})};c.prototype.getTextNodes=function(a){var b=[];if(0==a instanceof d||0==a.length)return b;a.each(function(){d(this).contents().filter(function(){return 3==this.nodeType?!0:!1}).each(function(){b.push(this)})});
return b};c.prototype.getKeywordRegexp=function(a){var b="string"!==typeof a?this.keyword:a;if("string"!==typeof b||""==b)return b;a=b;if(this.options.diacritics)for(var b=b.split(""),l=[],d=0,e=b.length;d<e;d++)for(var f=b[d],c=0,g=this.diacritics.length;c<g;c++){var k=this.diacritics[c];-1==k.indexOf(f)||-1<l.indexOf(k)||(a=a.replace(new RegExp("["+k+"]","gmi"),"["+k+"]"),l.push(k))}return a};c.prototype.highlight=function(a){var b="string"!==typeof a?this.keyword:a;if(""==b)return!0;if(0==this.$elements.length)return this.options.debug&&
console.log("No search context provided"),!1;this.$elements=this.$elements.filter("*:not([data-jmHighlight])");a=this.options.separateWordSearch;if("boolean"===typeof a&&a&&(a=b.split(" "),1<a.length)){this.options.debug&&console.log("Highlighting keywords separately");for(var b=0,d=a.length;b<d;b++)if(!this.highlight(a[b]))return!1;return!0}this.options.debug&&(console.log("Highlighting keyword '"+b+"' in elements:"),console.log(this.$elements));a=this.getKeywordRegexp(b);for(var b=new RegExp(a,
"mi"),d=this.getTextNodes(this.$elements),c=0,e=d.length;c<e;c++){var f=d[c];if("object"===typeof f&&"string"===typeof f.nodeValue&&""!=f.nodeValue.trim()&&!1!==b.test(f.nodeValue)){this.options.debug&&console.log("Regex: '"+a+"'. Node value: '"+f.nodeValue+"'");var g="<"+this.options.element+" class='"+this.options.className+"' data-jmHighlight='true'>",m="</"+this.options.element+">";null!=f.parentNode&&(f.parentNode.innerHTML=f.parentNode.innerHTML.replace(new RegExp("((?![^<]*>)"+a+")","gim"),
g+"$1"+m))}}return!0};c.prototype.removeHighlight=function(){if(0==this.$elements.length)return this.options.debug&&console.log("No search context provided"),!1;this.options.debug&&("string"===typeof this.keyword&&""!=this.keyword?console.log("Removing highlighting with keyword: '"+this.keyword+"'"):console.log("Removing highlighting"));var a=new RegExp(this.getKeywordRegexp(),"mi"),b=this.options.element+"[data-jmHighlight]."+this.options.className,c=this,h=this.$elements.filter(b);this.options.debug&&
(console.log(b),console.log(h));h.each(function(){var b=d(this);if(a.test(b.text()))c.appendTextNodes(b,h);else return!0});return!0};c.prototype.appendTextNodes=function(a,b){if(0==a instanceof d||0==a.length)return!1;var c=a.first()[0],h=c.previousSibling,c=c.nextSibling,e=d(h),f=d(c),g=!1;0<e.length&&(3==h.nodeType?(h.nodeValue+=a.text(),a.remove()):b instanceof d&&0<b.length&&b.is(e)?(e.replaceWith(a.text()+e.text()),a.remove()):a.replaceWith(a.text()),g=!0);0<f.length&&(3==c.nodeType?0==e.length?
(c.nodeValue=a.text()+c.nodeValue,a.remove()):(c.nodeValue=e.text()+c.nodeValue,e.remove()):b instanceof d&&0<b.length&&b.is(f)?0==e.length?(f.replaceWith(f.text()+a.text()),a.remove()):(f.replaceWith(e.text()+f.text()),e.remove()):0==e.length&&a.replaceWith(a.text()),g=!0);0==g&&a.replaceWith(a.text());return!0};d.fn.jmHighlight=function(a,b){return(new c(d(this),a,b)).highlight()};d.fn.jmRemoveHighlight=function(a,b){return(new c(d(this),b,a)).removeHighlight()}});
